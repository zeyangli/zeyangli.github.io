<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>5-2 Jenkins å£°æ˜å¼ä¸è„šæœ¬å¼è¯­æ³• - Jenkins2 Pipeline Docs</title>
<meta name="description" content="â˜ï¸â˜€ï¸ğŸŒ«ğŸŒ©">
<meta name="generator" content="Hugo 0.58.1" />
<link href="http://zeyangli.github.ioindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="http://zeyangli.github.io/chapter5/2/">
<link rel="stylesheet" href="http://zeyangli.github.io/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="http://zeyangli.github.io/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="http://zeyangli.github.io/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="http://zeyangli.github.io/js/jquery.backtothetop/jquery.backtothetop.min.js"></script></head>
<body>
<div class="container"><header>
<h1>Jenkins2 Pipeline Docs</h1>

 <span class="version">Version 0.0.1</span>
<a href="https://github.com/zeyangli/Jenkinsdocs" class="github"><i class="fab fa-github"></i></a>
<p class="description">â˜ï¸â˜€ï¸ğŸŒ«ğŸŒ©</p>

</header>
<div class="menu">
<nav>
<ul>
<li><a href="/">Home</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>5-2 Jenkins å£°æ˜å¼ä¸è„šæœ¬å¼è¯­æ³•</h1>

<h2 id="1-å£°æ˜å¼pipeline">1. å£°æ˜å¼Pipeline</h2>

<p>å£°æ˜å¼Pipleineæ˜¯æœ€è¿‘æ·»åŠ åˆ°Jenkinsæµæ°´çº¿çš„ï¼Œå®ƒåœ¨æµæ°´çº¿å­ç³»ç»Ÿä¹‹ä¸Šæä¾›äº†ä¸€ç§æ›´ç®€å•ï¼Œæ›´æœ‰ä¸»è§çš„è¯­æ³•ã€‚
æ‰€æœ‰çš„å£°æ˜å¼Pipelineéƒ½å¿…é¡»åŒ…å«ä¸€ä¸ª   <code>pipeline</code>å—ä¸­ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="c1">//run
</span><span class="c1"></span><span class="o">}</span></code></pre></div>
<p>åœ¨å£°æ˜å¼Pipelineä¸­çš„åŸºæœ¬è¯­å¥å’Œè¡¨è¾¾å¼éµå¾ªGroovyçš„è¯­æ³•ã€‚ä½†æ˜¯æœ‰ä»¥ä¸‹ä¾‹å¤–ï¼š</p>

<ul>
<li>æµæ°´çº¿é¡¶å±‚å¿…é¡»æ˜¯ä¸€ä¸ªå—ï¼Œç‰¹åˆ«æ˜¯pipelin{}ã€‚</li>
<li>ä¸éœ€è¦åˆ†å·ä½œä¸ºåˆ†å‰²ç¬¦ï¼Œæ˜¯æŒ‰ç…§è¡Œåˆ†å‰²çš„ã€‚</li>
<li>è¯­å¥å—åªèƒ½ç”±é˜¶æ®µã€æŒ‡ä»¤ã€æ­¥éª¤ã€èµ‹å€¼è¯­å¥ç»„æˆã€‚ä¾‹å¦‚: inputè¢«è§†ä¸ºinput()ã€‚</li>
</ul>

<h3 id="1-1-agent-ä»£ç†">1.1 agent(ä»£ç†)</h3>

<p>agent æŒ‡å®šäº†æµæ°´çº¿çš„æ‰§è¡ŒèŠ‚ç‚¹ã€‚</p>

<p>å‚æ•°ï¼š</p>

<ul>
<li>any åœ¨ä»»ä½•å¯ç”¨çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œpipelineã€‚</li>
<li>none æ²¡æœ‰æŒ‡å®šagentçš„æ—¶å€™é»˜è®¤ã€‚</li>
<li>label åœ¨æŒ‡å®šæ ‡ç­¾ä¸Šçš„èŠ‚ç‚¹ä¸Šè¿è¡ŒPipelineã€‚</li>

<li><p>node å…è®¸é¢å¤–çš„é€‰é¡¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="err">è¿™ä¸¤ç§æ˜¯ä¸€æ ·çš„</span>
<span class="n">agent</span> <span class="o">{</span> <span class="n">node</span> <span class="o">{</span> <span class="n">label</span> <span class="s1">&#39;labelname&#39;</span> <span class="o">}}</span>
<span class="n">aget</span> <span class="o">{</span> <span class="n">label</span> <span class="s1">&#39; labelname &#39;</span><span class="o">}</span></code></pre></div></li>
</ul>

<h3 id="1-2-post">1.2 post</h3>

<p>å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªsteps ï¼Œè¿™äº›é˜¶æ®µæ ¹æ®æµæ°´çº¿æˆ–é˜¶æ®µçš„å®Œæˆæƒ…å†µè€Œ è¿è¡Œ(å–å†³äºæµæ°´çº¿ä¸­<code>post</code>éƒ¨åˆ†çš„ä½ç½®). post æ”¯æŒä»¥ä¸‹ post-condition å—ä¸­çš„å…¶ä¸­ä¹‹ä¸€: always, changed, failure, success, unstable, å’Œ abortedã€‚è¿™äº›æ¡ä»¶å—å…è®¸åœ¨ post éƒ¨åˆ†çš„æ­¥éª¤çš„æ‰§è¡Œå–å†³äºæµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ã€‚</p>

<ul>
<li>always æ— è®ºæµæ°´çº¿æˆ–è€…é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ã€‚</li>
<li>changed åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µå®ŒæˆçŠ¶æ€ä¸ä¹‹å‰ä¸åŒæ—¶ã€‚</li>
<li>failure åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µçŠ¶æ€ä¸º&rdquo;failure&rdquo;è¿è¡Œã€‚</li>
<li>success åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µçŠ¶æ€ä¸º&rdquo;success&rdquo;è¿è¡Œã€‚</li>
<li>unstable åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µçŠ¶æ€ä¸º&rdquo;unstable&rdquo;è¿è¡Œã€‚ä¾‹å¦‚ï¼šæµ‹è¯•å¤±è´¥ã€‚</li>

<li><p>aborted  åªæœ‰å½“æµæ°´çº¿æˆ–è€…é˜¶æ®µçŠ¶æ€ä¸º&rdquo;aborted &ldquo;è¿è¡Œã€‚ä¾‹å¦‚ï¼šæ‰‹åŠ¨å–æ¶ˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
<span class="n">agent</span> <span class="n">any</span>
<span class="n">stages</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">steps</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">post</span> <span class="o">{</span> 
    <span class="n">always</span> <span class="o">{</span> 
        <span class="n">echo</span> <span class="s1">&#39;I will always say Hello again!&#39;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span></code></pre></div></li>
</ul>

<h3 id="1-3-stages-é˜¶æ®µ">1.3 stages(é˜¶æ®µ)</h3>

<p>åŒ…å«ä¸€ç³»åˆ—ä¸€ä¸ªæˆ–å¤šä¸ª stage æŒ‡ä»¤, å»ºè®® stages è‡³å°‘åŒ…å«ä¸€ä¸ª stage æŒ‡ä»¤ç”¨äºè¿ç»­äº¤ä»˜è¿‡ç¨‹çš„æ¯ä¸ªç¦»æ•£éƒ¨åˆ†,æ¯”å¦‚æ„å»º, æµ‹è¯•, å’Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span> 
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h3 id="1-4-steps-æ­¥éª¤">1.4 steps(æ­¥éª¤)</h3>

<p>stepæ˜¯æ¯ä¸ªé˜¶æ®µä¸­è¦æ‰§è¡Œçš„æ¯ä¸ªæ­¥éª¤ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span> 
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h3 id="1-5-æŒ‡ä»¤">1.5 æŒ‡ä»¤</h3>

<h4 id="1-5-1-environment">1.5.1 environment</h4>

<p>environment æŒ‡ä»¤æŒ‡å®šä¸€ä¸ªé”®å€¼å¯¹åºåˆ—ï¼Œè¯¥åºåˆ—å°†è¢«å®šä¹‰ä¸ºæ‰€æœ‰æ­¥éª¤çš„ç¯å¢ƒå˜é‡ï¼Œæˆ–è€…æ˜¯ç‰¹å®šäºé˜¶æ®µçš„æ­¥éª¤ï¼Œè¿™å–å†³äº environment æŒ‡ä»¤åœ¨æµæ°´çº¿å†…çš„ä½ç½®ã€‚</p>

<p>è¯¥æŒ‡ä»¤æ”¯æŒä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• credentials() ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºåœ¨Jenkinsç¯å¢ƒä¸­é€šè¿‡æ ‡è¯†ç¬¦è®¿é—®é¢„å®šä¹‰çš„å‡­è¯ã€‚å¯¹äºç±»å‹ä¸º &ldquo;Secret Text&rdquo;çš„å‡­è¯, credentials() å°†ç¡®ä¿æŒ‡å®šçš„ç¯å¢ƒå˜é‡åŒ…å«ç§˜å¯†æ–‡æœ¬å†…å®¹ã€‚å¯¹äºç±»å‹ä¸º &ldquo;SStandard username and password&rdquo;çš„å‡­è¯, æŒ‡å®šçš„ç¯å¢ƒå˜é‡æŒ‡å®šä¸º username:password ï¼Œå¹¶ä¸”ä¸¤ä¸ªé¢å¤–çš„ç¯å¢ƒå˜é‡å°†è¢«è‡ªåŠ¨å®šä¹‰ :åˆ†åˆ«ä¸º MYVARNAME_USR å’Œ MYVARNAME_PSW ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">environment</span> <span class="o">{</span> 
        <span class="n">CC</span> <span class="o">=</span> <span class="s1">&#39;clang&#39;</span>
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">environment</span> <span class="o">{</span> 
                <span class="n">AN_ACCESS_KEY</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">(</span><span class="s1">&#39;my-prefined-secret-text&#39;</span><span class="o">)</span> 
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">&#39;printenv&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h4 id="1-5-2-options">1.5.2 options</h4>

<p>options æŒ‡ä»¤å…è®¸ä»æµæ°´çº¿å†…éƒ¨é…ç½®ç‰¹å®šäºæµæ°´çº¿çš„é€‰é¡¹ã€‚ æµæ°´çº¿æä¾›äº†è®¸å¤šè¿™æ ·çš„é€‰é¡¹, æ¯”å¦‚<code>buildDiscarder</code>,ä½†ä¹Ÿå¯ä»¥ç”±æ’ä»¶æä¾›, æ¯”å¦‚ timestampsã€‚</p>

<ul>
<li>buildDiscarder: ä¸ºæœ€è¿‘çš„æµæ°´çº¿è¿è¡Œçš„ç‰¹å®šæ•°é‡ä¿å­˜ç»„ä»¶å’Œæ§åˆ¶å°è¾“å‡ºã€‚</li>
<li>disableConcurrentBuilds: ä¸å…è®¸åŒæ—¶æ‰§è¡Œæµæ°´çº¿ã€‚ å¯è¢«ç”¨æ¥é˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰ã€‚</li>
<li>overrideIndexTriggers: å…è®¸è¦†ç›–åˆ†æ”¯ç´¢å¼•è§¦å‘å™¨çš„é»˜è®¤å¤„ç†ã€‚</li>
<li>skipDefaultCheckout: åœ¨<code>agent</code> æŒ‡ä»¤ä¸­ï¼Œè·³è¿‡ä»æºä»£ç æ§åˆ¶ä¸­æ£€å‡ºä»£ç çš„é»˜è®¤æƒ…å†µã€‚</li>
<li>skipStagesAfterUnstable: ä¸€æ—¦æ„å»ºçŠ¶æ€å˜å¾—UNSTABLEï¼Œè·³è¿‡è¯¥é˜¶æ®µã€‚</li>
<li>checkoutToSubdirectory: åœ¨å·¥ä½œç©ºé—´çš„å­ç›®å½•ä¸­è‡ªåŠ¨åœ°æ‰§è¡Œæºä»£ç æ§åˆ¶æ£€å‡ºã€‚</li>
<li>timeout: è®¾ç½®æµæ°´çº¿è¿è¡Œçš„è¶…æ—¶æ—¶é—´, åœ¨æ­¤ä¹‹åï¼ŒJenkinså°†ä¸­æ­¢æµæ°´çº¿ã€‚</li>
<li>retry: åœ¨å¤±è´¥æ—¶, é‡æ–°å°è¯•æ•´ä¸ªæµæ°´çº¿çš„æŒ‡å®šæ¬¡æ•°ã€‚</li>

<li><p>timestamps é¢„æµ‹æ‰€æœ‰ç”±æµæ°´çº¿ç”Ÿæˆçš„æ§åˆ¶å°è¾“å‡ºï¼Œä¸è¯¥æµæ°´çº¿å‘å‡ºçš„æ—¶é—´ä¸€è‡´ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="c1">//æŒ‡å®šä¸€ä¸ªå°æ—¶çš„å…¨å±€æ‰§è¡Œè¶…æ—¶, åœ¨æ­¤ä¹‹åï¼ŒJenkinså°†ä¸­æ­¢æµæ°´çº¿è¿è¡Œã€‚
</span><span class="c1"></span><span class="n">pipeline</span> <span class="o">{</span>
<span class="n">agent</span> <span class="n">any</span>
<span class="n">options</span> <span class="o">{</span>
    <span class="n">timeout</span><span class="o">(</span><span class="nl">time:</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">unit:</span> <span class="s1">&#39;HOURS&#39;</span><span class="o">)</span> 
<span class="o">}</span>
<span class="n">stages</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">steps</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span></code></pre></div></li>
</ul>

<h4 id="1-5-3-å‚æ•°">1.5.3 å‚æ•°</h4>

<p>ä¸ºæµæ°´çº¿è¿è¡Œæ—¶è®¾ç½®é¡¹ç›®ç›¸å…³çš„å‚æ•°</p>

<ul>
<li><p>string å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°, ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">parameters</span> <span class="o">{</span> <span class="n">string</span><span class="o">(</span><span class="nl">name:</span> <span class="s1">&#39;DEPLOY_ENV&#39;</span><span class="o">,</span> <span class="nl">defaultValue:</span> <span class="s1">&#39;staging&#39;</span><span class="o">,</span> <span class="nl">description:</span> <span class="s1">&#39;&#39;</span><span class="o">)</span> <span class="o">}</span></code></pre></div></li>

<li><p>booleanParam å¸ƒå°”å‚æ•°, ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">parameters</span> <span class="o">{</span> <span class="n">booleanParam</span><span class="o">(</span><span class="nl">name:</span> <span class="s1">&#39;DEBUG_BUILD&#39;</span><span class="o">,</span> <span class="nl">defaultValue:</span> <span class="kc">true</span><span class="o">,</span> <span class="nl">description:</span> <span class="s1">&#39;&#39;</span><span class="o">)</span> <span class="o">}</span></code></pre></div></li>

<li><p>ç¤ºä¾‹</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
<span class="n">agent</span> <span class="n">any</span>
<span class="n">parameters</span> <span class="o">{</span>
    <span class="n">string</span><span class="o">(</span><span class="nl">name:</span> <span class="s1">&#39;PERSON&#39;</span><span class="o">,</span> <span class="nl">defaultValue:</span> <span class="s1">&#39;Mr Jenkins&#39;</span><span class="o">,</span> <span class="nl">description:</span> <span class="s1">&#39;Who should I say hello to?&#39;</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">stages</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">steps</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s2">&#34;Hello ${params.PERSON}&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span></code></pre></div></li>
</ul>

<h4 id="1-5-4-è§¦å‘å™¨">1.5.4 è§¦å‘å™¨</h4>

<p>æ„å»ºè§¦å‘å™¨</p>

<ul>
<li><p>cron è®¡åˆ’ä»»åŠ¡å®šæœŸæ‰§è¡Œæ„å»ºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">triggers</span> <span class="o">{</span> <span class="n">cron</span><span class="o">(</span><span class="s1">&#39;H */4 * * 1-5&#39;</span><span class="o">)</span> <span class="o">}</span></code></pre></div></li>

<li><p>pollSCM ä¸cronå®šä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯ç”±jenkinså®šæœŸæ£€æµ‹æºç å˜åŒ–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">triggers</span> <span class="o">{</span> <span class="n">pollSCM</span><span class="o">(</span><span class="s1">&#39;H */4 * * 1-5&#39;</span><span class="o">)</span> <span class="o">}</span></code></pre></div></li>

<li><p>upstream æ¥å—é€—å·åˆ†éš”çš„å·¥ä½œå­—ç¬¦ä¸²å’Œé˜ˆå€¼ã€‚ å½“å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•ä½œä¸šä»¥æœ€å°é˜ˆå€¼ç»“æŸæ—¶ï¼Œæµæ°´çº¿è¢«é‡æ–°è§¦å‘ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">triggers</span> <span class="o">{</span> <span class="n">upstream</span><span class="o">(</span><span class="nl">upstreamProjects:</span> <span class="s1">&#39;job1,job2&#39;</span><span class="o">,</span> <span class="nl">threshold:</span> <span class="n">hudson</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">Result</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span> <span class="o">}</span></code></pre></div></li>

<li><p>ç¤ºä¾‹</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
<span class="n">agent</span> <span class="n">any</span>
<span class="n">triggers</span> <span class="o">{</span>
    <span class="n">cron</span><span class="o">(</span><span class="s1">&#39;H */4 * * 1-5&#39;</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">stages</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">steps</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span></code></pre></div></li>
</ul>

<h4 id="1-5-5-tool">1.5.5 tool</h4>

<p>è·å–é€šè¿‡è‡ªåŠ¨å®‰è£…æˆ–æ‰‹åŠ¨æ”¾ç½®å·¥å…·çš„ç¯å¢ƒå˜é‡ã€‚æ”¯æŒmaven/jdk/gradleã€‚å·¥å…·çš„åç§°å¿…é¡»åœ¨ç³»ç»Ÿè®¾ç½®-&gt;å…¨å±€å·¥å…·é…ç½®ä¸­å®šä¹‰ã€‚</p>

<p>ç¤ºä¾‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">tools</span> <span class="o">{</span>
        <span class="n">maven</span> <span class="s1">&#39;apache-maven-3.0.1&#39;</span> 
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">&#39;mvn --version&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h4 id="1-5-6-input">1.5.6 input</h4>

<p>inputç”¨æˆ·åœ¨æ‰§è¡Œå„ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œç”±äººå·¥ç¡®è®¤æ˜¯å¦ç»§ç»­è¿›è¡Œã€‚</p>

<ul>
<li>message  å‘ˆç°ç»™ç”¨æˆ·çš„æç¤ºä¿¡æ¯ã€‚</li>
<li>id å¯é€‰ï¼Œé»˜è®¤ä¸ºstageåç§°ã€‚</li>
<li>ok é»˜è®¤è¡¨å•ä¸Šçš„okæ–‡æœ¬ã€‚</li>
<li>submitter å¯é€‰çš„,ä»¥é€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨æˆ–å…è®¸æäº¤çš„å¤–éƒ¨ç»„åã€‚é»˜è®¤å…è®¸ä»»ä½•ç”¨æˆ·ã€‚</li>
<li>submitterParameter ç¯å¢ƒå˜é‡çš„å¯é€‰åç§°ã€‚å¦‚æœå­˜åœ¨ï¼Œç”¨<code>submitter</code> åç§°è®¾ç½®ã€‚</li>
<li>parameters æç¤ºæäº¤è€…æä¾›çš„ä¸€ä¸ªå¯é€‰çš„å‚æ•°åˆ—è¡¨ã€‚</li>
</ul>

<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">input</span> <span class="o">{</span>
                <span class="n">message</span> <span class="s2">&#34;Should we continue?&#34;</span>
                <span class="n">ok</span> <span class="s2">&#34;Yes, we should.&#34;</span>
                <span class="n">submitter</span> <span class="s2">&#34;alice,bob&#34;</span>
                <span class="n">parameters</span> <span class="o">{</span>
                    <span class="n">string</span><span class="o">(</span><span class="nl">name:</span> <span class="s1">&#39;PERSON&#39;</span><span class="o">,</span> <span class="nl">defaultValue:</span> <span class="s1">&#39;Mr Jenkins&#39;</span><span class="o">,</span> <span class="nl">description:</span> <span class="s1">&#39;Who should I say hello to?&#39;</span><span class="o">)</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s2">&#34;Hello, ${PERSON}, nice to meet you.&#34;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h4 id="1-5-7-when">1.5.7 when</h4>

<p>when æŒ‡ä»¤å…è®¸æµæ°´çº¿æ ¹æ®ç»™å®šçš„æ¡ä»¶å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œé˜¶æ®µã€‚ when æŒ‡ä»¤å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ã€‚ å¦‚æœ<code>when</code> æŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶, æ‰€æœ‰çš„å­æ¡ä»¶å¿…é¡»è¿”å›Trueï¼Œé˜¶æ®µæ‰èƒ½æ‰§è¡Œã€‚ è¿™ä¸å­æ¡ä»¶åœ¨ allOf æ¡ä»¶ä¸‹åµŒå¥—çš„æƒ…å†µç›¸åŒã€‚</p>

<p>å†…ç½®æ¡ä»¶</p>

<ul>
<li><p>branch: å½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸æ¨¡å¼ç»™å®šçš„åˆ†æ”¯åŒ¹é…æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,è¿™åªé€‚ç”¨äºå¤šåˆ†æ”¯æµæ°´çº¿ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">when</span> <span class="o">{</span> <span class="n">branch</span> <span class="s1">&#39;master&#39;</span> <span class="o">}</span></code></pre></div></li>

<li><p>environment: å½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡æ˜¯ç»™å®šçš„å€¼æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªæ­¥éª¤,ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">when</span> <span class="o">{</span> <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;production&#39;</span> <span class="o">}</span></code></pre></div></li>

<li><p>expression å½“æŒ‡å®šçš„Groovyè¡¨è¾¾å¼è¯„ä¼°ä¸ºtrueæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ, ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">when</span> <span class="o">{</span> <span class="n">expression</span> <span class="o">{</span> <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="na">DEBUG_BUILD</span> <span class="o">}</span> <span class="o">}</span></code></pre></div></li>

<li><p>not å½“åµŒå¥—æ¡ä»¶æ˜¯é”™è¯¯æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,å¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">when</span> <span class="o">{</span> <span class="n">not</span> <span class="o">{</span> <span class="n">branch</span> <span class="s1">&#39;master&#39;</span> <span class="o">}</span> <span class="o">}</span></code></pre></div></li>

<li><p>allOf å½“æ‰€æœ‰çš„åµŒå¥—æ¡ä»¶éƒ½æ­£ç¡®æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">when</span> <span class="o">{</span> <span class="n">allOf</span> <span class="o">{</span> <span class="n">branch</span> <span class="s1">&#39;master&#39;</span><span class="o">;</span> <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;production&#39;</span> <span class="o">}</span> <span class="o">}</span></code></pre></div></li>

<li><p>anyOf å½“è‡³å°‘æœ‰ä¸€ä¸ªåµŒå¥—æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">when</span> <span class="o">{</span> <span class="n">anyOf</span> <span class="o">{</span> <span class="n">branch</span> <span class="s1">&#39;master&#39;</span><span class="o">;</span> <span class="n">branch</span> <span class="s1">&#39;staging&#39;</span> <span class="o">}</span> <span class="o">}</span></code></pre></div></li>
</ul>

<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Build&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Deploy&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">&#39;production&#39;</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Deploying&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Build&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Deploy&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">&#39;production&#39;</span>
                <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;production&#39;</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Deploying&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Build&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Deploy&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">allOf</span> <span class="o">{</span>
                    <span class="n">branch</span> <span class="s1">&#39;production&#39;</span>
                    <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;production&#39;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Deploying&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Build&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Deploy&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">&#39;production&#39;</span>
                <span class="n">anyOf</span> <span class="o">{</span>
                    <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;production&#39;</span>
                    <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;staging&#39;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Deploying&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Build&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Deploy&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">expression</span> <span class="o">{</span> <span class="n">BRANCH_NAME</span> <span class="o">==~</span> <span class="s">/(production|staging)/</span> <span class="o">}</span>
                <span class="n">anyOf</span> <span class="o">{</span>
                    <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;production&#39;</span>
                    <span class="n">environment</span> <span class="nl">name:</span> <span class="s1">&#39;DEPLOY_TO&#39;</span><span class="o">,</span> <span class="nl">value:</span> <span class="s1">&#39;staging&#39;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Deploying&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">none</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Build&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example Deploy&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">agent</span> <span class="o">{</span>
                <span class="n">label</span> <span class="s2">&#34;some-label&#34;</span>
            <span class="o">}</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">beforeAgent</span> <span class="kc">true</span>
                <span class="n">branch</span> <span class="s1">&#39;production&#39;</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Deploying&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h4 id="1-5-8-å¹¶è¡Œ">1.5.8  å¹¶è¡Œ</h4>

<p>å£°æ˜å¼æµæ°´çº¿çš„é˜¶æ®µå¯ä»¥åœ¨ä»–ä»¬å†…éƒ¨å£°æ˜å¤šéš”åµŒå¥—é˜¶æ®µ, å®ƒä»¬å°†å¹¶è¡Œæ‰§è¡Œã€‚ æ³¨æ„ï¼Œä¸€ä¸ªé˜¶æ®µå¿…é¡»åªæœ‰ä¸€ä¸ª steps æˆ– <code>parallel</code>çš„é˜¶æ®µã€‚ åµŒå¥—é˜¶æ®µæœ¬èº«ä¸èƒ½åŒ…å« è¿›ä¸€æ­¥çš„ <code>parallel</code> é˜¶æ®µ, ä½†æ˜¯å…¶ä»–çš„é˜¶æ®µçš„è¡Œä¸ºä¸ä»»ä½•å…¶ä»– stage<code>parallel</code>çš„é˜¶æ®µä¸èƒ½åŒ…å« <code>agent</code> æˆ– <code>tools</code>é˜¶æ®µ, å› ä¸ºä»–ä»¬æ²¡æœ‰ç›¸å…³ <code>steps</code>ã€‚</p>

<p>å¦å¤–, é€šè¿‡æ·»åŠ  <code>failFast true</code> åˆ°åŒ…å«<code>parallel</code>çš„ <code>stage</code>ä¸­ï¼Œ å½“å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹å¤±è´¥æ—¶ï¼Œä½ å¯ä»¥å¼ºåˆ¶æ‰€æœ‰çš„ <code>parallel</code> é˜¶æ®µéƒ½è¢«ç»ˆæ­¢ã€‚</p>

<p>ç¤ºä¾‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Non-Parallel Stage&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;This stage will be executed first.&#39;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Parallel Stage&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">&#39;master&#39;</span>
            <span class="o">}</span>
            <span class="n">failFast</span> <span class="kc">true</span>
            <span class="n">parallel</span> <span class="o">{</span>
                <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Branch A&#39;</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">agent</span> <span class="o">{</span>
                        <span class="n">label</span> <span class="s2">&#34;for-branch-a&#34;</span>
                    <span class="o">}</span>
                    <span class="n">steps</span> <span class="o">{</span>
                        <span class="n">echo</span> <span class="s2">&#34;On Branch A&#34;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Branch B&#39;</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">agent</span> <span class="o">{</span>
                        <span class="n">label</span> <span class="s2">&#34;for-branch-b&#34;</span>
                    <span class="o">}</span>
                    <span class="n">steps</span> <span class="o">{</span>
                        <span class="n">echo</span> <span class="s2">&#34;On Branch B&#34;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h3 id="1-6-stepæ­¥éª¤">1.6 stepæ­¥éª¤</h3>

<h4 id="1-6-1-script">1.6.1 script</h4>

<p>script æ­¥éª¤éœ€è¦ [scripted-pipeline]å—å¹¶åœ¨å£°æ˜å¼æµæ°´çº¿ä¸­æ‰§è¡Œã€‚å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´,åº”è¯¥å£°æ˜å¼æµæ°´çº¿ä¸­çš„â€œè„šæœ¬â€æ­¥éª¤æ˜¯ä¸å¿…è¦çš„ï¼Œä½†æ˜¯å®ƒå¯ä»¥æä¾›ä¸€ä¸ªæœ‰ç”¨çš„&rdquo;é€ƒç”Ÿå‡ºå£&rdquo;ã€‚éå¹³å‡¡çš„è§„æ¨¡å’Œ/æˆ–å¤æ‚æ€§çš„<code>script</code>å—åº”è¯¥è¢«è½¬ç§»åˆ° å…±äº«åº“ ã€‚</p>

<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s1">&#39;Hello World&#39;</span>

                <span class="n">script</span> <span class="o">{</span>
                    <span class="kt">def</span> <span class="n">browsers</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;chrome&#39;</span><span class="o">,</span> <span class="s1">&#39;firefox&#39;</span><span class="o">]</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">browsers</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">echo</span> <span class="s2">&#34;Testing the ${browsers[i]} browser&#34;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h2 id="2-è„šæœ¬åŒ–pipeline">2. è„šæœ¬åŒ–Pipeline</h2>

<p>è„šæœ¬åŒ–æµæ°´çº¿, ä¸å£°æ˜å¼ä¸€æ ·çš„æ˜¯, æ˜¯å»ºç«‹åœ¨åº•å±‚æµæ°´çº¿çš„å­ç³»ç»Ÿä¸Šçš„ã€‚ä¸å£°æ˜å¼ä¸åŒçš„æ˜¯, è„šæœ¬åŒ–æµæ°´çº¿å®é™…ä¸Šæ˜¯ç”± Groovyæ„å»ºçš„é€šç”¨ DSL ã€‚ Groovy è¯­è¨€æä¾›çš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½å¯ä»¥ç”¨äºè„šæœ¬åŒ–æµæ°´çº¿çš„ç”¨æˆ·ã€‚è¿™æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªéå¸¸æœ‰è¡¨ç°åŠ›å’Œçµæ´»çš„å·¥å…·ï¼Œå¯ä»¥é€šè¿‡å®ƒç¼–å†™æŒç»­äº¤ä»˜æµæ°´çº¿ã€‚</p>

<h3 id="2-1-æµç¨‹æ§åˆ¶">2.1 æµç¨‹æ§åˆ¶</h3>

<p>è„šæœ¬åŒ–æµæ°´çº¿ä»<code>Jenkinsfile</code>çš„é¡¶éƒ¨å¼€å§‹å‘ä¸‹ä¸²è¡Œæ‰§è¡Œ, å°±åƒ Groovy æˆ–å…¶ä»–è¯­è¨€ä¸­çš„å¤§å¤šæ•°ä¼ ç»Ÿè„šæœ¬ä¸€æ ·ã€‚ å› æ­¤ï¼Œæä¾›æµæ§åˆ¶å–å†³äº Groovy è¡¨è¾¾å¼, æ¯”å¦‚ if/else æ¡ä»¶, ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">node</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">BRANCH_NAME</span> <span class="o">==</span> <span class="s1">&#39;master&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s1">&#39;I only execute on the master branch&#39;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s1">&#39;I execute elsewhere&#39;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨Groovyçš„å¼‚å¸¸å¤„ç†æ”¯æŒæ¥ç®¡ç†è„šæœ¬åŒ–æµæ°´çº¿æµæ§åˆ¶ã€‚å½“ æ­¥éª¤ å¤±è´¥ ï¼Œæ— è®ºä»€ä¹ˆåŸå› ï¼Œå®ƒä»¬éƒ½ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å¤„ç†é”™è¯¯çš„è¡Œä¸ºå¿…é¡»ä½¿ç”¨Groovyä¸­çš„ try/catch/finally å— , ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">node</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Example&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">sh</span> <span class="s1">&#39;exit 1&#39;</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="n">exc</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s1">&#39;Something failed, I should sound the klaxons!&#39;</span>
            <span class="k">throw</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div><div class="edit-meta">
Last updated on 17 Oct 2017


<br>
Published on 17 Oct 2017
<br><a href="https://github.com/zeyangli/Jenkinsdocs/edit/master/content/chapter5/2.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="/chapter5/1/" title="5-1 Jenkins Pipelineè¯­æ³•"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - 5-1 Jenkins Pipelineè¯­æ³•</a>
<a class="nav nav-next" href="/chapter6/" title="ç¬¬å…­ç«  Jenkinsæµæ°´çº¿å®è·µ">Next - ç¬¬å…­ç«  Jenkinsæµæ°´çº¿å®è·µ <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">
<nav>
<ul>
<li class=""><a href="http://zeyangli.github.io">Home</a></li>

<li class=""><a href="/chapter1/">ç¬¬ä¸€ç«  è®¤è¯†Jenkins</a>
<ul class="">
<li class=""><a href="/chapter1/1/">1-1 Jenkinsç®€ä»‹</a></li>
<li class=""><a href="/chapter1/2/">1-2 Jenkins WebUI</a></li>
<li class=""><a href="/chapter1/3/">1-3 Jenkinsæ„å»º</a></li>
</ul>
  
</li>

<li class=""><a href="/chapter2/">ç¬¬äºŒç«  å®‰è£…Jenkins</a>
<ul class="">
<li class=""><a href="/chapter2/1/">2-1 åŸºäºWARåŒ…éƒ¨ç½²</a></li>
<li class=""><a href="/chapter2/2/">2-2 åŸºäºMACç³»ç»Ÿéƒ¨ç½²</a></li>
<li class=""><a href="/chapter2/3/">2-3 åŸºäºWindowsç³»ç»Ÿéƒ¨ç½²</a></li>
<li class=""><a href="/chapter2/4/">2-4 åŸºäºLinuxç³»ç»Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰</a></li>
<li class=""><a href="/chapter2/5/">2-5 å®‰è£…åé…ç½®</a></li>
</ul>
  
</li>

<li class=""><a href="/chapter3/">ç¬¬ä¸‰ç«  ç®¡ç†Jenkins</a>
<ul class="">
<li class=""><a href="/chapter3/1/">3-1 ç”¨æˆ·ç®¡ç†</a></li>
<li class=""><a href="/chapter3/2/">3-2 å‡­æ®ç®¡ç†</a></li>
<li class=""><a href="/chapter3/3/">3-3 æƒé™ç®¡ç†</a></li>
<li class=""><a href="/chapter3/4/">3-4 é¡¹ç›®ç®¡ç†</a></li>
<li class=""><a href="/chapter3/5/">3-5 è§†å›¾ç®¡ç†</a></li>
<li class=""><a href="/chapter3/6/">3-6 æ’ä»¶ç®¡ç†</a></li>
</ul>
  
</li>

<li class=""><a href="/chapter4/">ç¬¬å››ç«  Jenkinså·¥å…·é›†æˆ</a>
<ul class="">

<li class=""><a href="/chapter4/chapter4-1/">4-1 æ„å»ºå·¥å…·é›†æˆ</a>
<ul class="">
<li class=""><a href="/chapter4/chapter4-1/1/">4-1-1 é›†æˆmaven</a></li>
<li class=""><a href="/chapter4/chapter4-1/2/">4-1-2 é›†æˆant</a></li>
<li class=""><a href="/chapter4/chapter4-1/3/">4-1-3 é›†æˆgradle</a></li>
<li class=""><a href="/chapter4/chapter4-1/4/">4-1-4 é›†æˆnpm</a></li>
</ul>
  
</li>

<li class=""><a href="/chapter4/chapter4-2/">4-2 Ldapç”¨æˆ·è®¤è¯é›†æˆ</a>
<ul class="">
<li class=""><a href="/chapter4/chapter4-2/1/">4-2-1 å®‰è£…LdapæœåŠ¡</a></li>
<li class=""><a href="/chapter4/chapter4-2/2/">4-2-2 å®‰è£…Ldapæ§åˆ¶å°</a></li>
<li class=""><a href="/chapter4/chapter4-2/3/">4-2-3 é…ç½®LdapæœåŠ¡</a></li>
<li class=""><a href="/chapter4/chapter4-2/4/">4-2-4 åˆ›å»ºOUç»„ç»‡ç”¨æˆ·æ•°æ®</a></li>
<li class=""><a href="/chapter4/chapter4-2/5/">4-2-5 Jenkinsé›†æˆLdap</a></li>
</ul>
  
</li>

<li class=""><a href="/chapter4/chapter4-3/">4-3 Gitlabé›†æˆ</a>
<ul class="">
<li class=""><a href="/chapter4/chapter4-3/1/">4-3-1 Jenkinsé›†æˆGitlab SSOå•ç‚¹ç™»å½•</a></li>
<li class=""><a href="/chapter4/chapter4-3/2/">4-3-2 WebHooké›†æˆ</a></li>
</ul>
  
</li>
<li class=""><a href="/chapter4/2/">4-4 Jenkinsé›†æˆSaltStackæ‰¹é‡è‡ªåŠ¨åŒ–å‘å¸ƒ</a></li>
<li class=""><a href="/chapter4/3/">4-5 Jenkinsåˆ¶å“åº“é›†æˆ-Nexus</a></li>
<li class=""><a href="/chapter4/4/">4-6 Jenkinsé›†æˆç¦…é“</a></li>
<li class=""><a href="/chapter4/5/">4-7 Jenkinsé›†æˆåˆ¶å“åº“-Artifactory</a></li>
<li class=""><a href="/chapter4/6/">4-8 Jenkinsé›†æˆSonarQube</a></li>
</ul>
  
</li>

<li class="parent"><a href="/chapter5/">ç¬¬äº”ç«  JenkinsPipeline   [å¾…æ›´æ–°ğŸ˜„]</a>
<ul class="sub-menu">
<li class=""><a href="/chapter5/1/">5-1 Jenkins Pipelineè¯­æ³•</a></li>
<li class="active"><a href="/chapter5/2/">5-2 Jenkins å£°æ˜å¼ä¸è„šæœ¬å¼è¯­æ³•</a></li>
</ul>
  
</li>

<li class=""><a href="/chapter6/">ç¬¬å…­ç«  Jenkinsæµæ°´çº¿å®è·µ</a>
<ul class="">
<li class=""><a href="/chapter6/1/">6-1 å‰ç«¯é™æ€èµ„æºå‘å¸ƒæµæ°´çº¿</a></li>
<li class=""><a href="/chapter6/2/">6-2 NodeJsé¡¹ç›®å‘å¸ƒæµæ°´çº¿</a></li>
<li class=""><a href="/chapter6/3/">6-3 Dotneté¡¹ç›®å‘å¸ƒæµæ°´çº¿</a></li>
<li class=""><a href="/chapter6/4/">6-4 JAVA-Springbooté¡¹ç›®å‘å¸ƒæµæ°´çº¿</a></li>
<li class=""><a href="/chapter6/5/">6-5 Golangé¡¹ç›®å‘å¸ƒæµæ°´çº¿</a></li>

<li class=""><a href="/chapter6/chapter6-6/">6-6 ç§»åŠ¨ç«¯Androidé¡¹ç›®å‘å¸ƒæµæ°´çº¿</a>
<ul class="">
<li class=""><a href="/chapter6/chapter6-6/1/">6-6-1 æ­å»ºAndroidæ‰“åŒ…ç¯å¢ƒï¼ˆCentosï¼‰</a></li>
<li class=""><a href="/chapter6/chapter6-6/2/">6-6-2 æ‰‹åŠ¨å‘å¸ƒAndroidé¡¹ç›®</a></li>
<li class=""><a href="/chapter6/chapter6-6/3/">6-6-3 Jenkinså‘å¸ƒæµæ°´çº¿ï¼ˆFir|è’²å…¬è‹±ï¼‰</a></li>
</ul>
  
</li>
</ul>
  
</li>
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
